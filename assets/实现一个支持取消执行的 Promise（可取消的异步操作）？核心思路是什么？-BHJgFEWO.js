const e="### 实现一个支持取消执行的 Promise（可取消的异步操作）？核心思路是什么？\n\n**答：**\n\n#### （1）核心思路\n\n- 封装原生 Promise，维护「取消状态」（`isCanceled`）；\n- 提供 `cancel` 方法，调用时标记 `isCanceled = true`，阻止后续 `resolve/reject` 执行；\n- 若异步操作支持中止（如 `fetch` 的 `AbortController`），则在 `cancel` 中调用中止方法，释放资源；\n- 取消后触发自定义回调（如 `onCancel`），通知取消结果。\n\n#### （2）实现代码\n\njavascript\n\n运行\n\n```javascript\nclass CancelablePromise {constructor(executor) {this.isCanceled = false; // 取消状态this.promise = new Promise((resolve, reject) => {this.resolve = resolve;this.reject = reject;// 执行原 executor，注入 cancel 逻辑executor((value) => !this.isCanceled && resolve(value),(reason) => !this.isCanceled && reject(reason));});}// 取消方法cancel(reason = 'Promise 已取消') {if (this.isCanceled) return;this.isCanceled = true;this.reject(new Error(reason)); // 触发 reject// 若有异步操作中止逻辑（如 AbortController），可在此调用this.onCancel?.();}// 注册取消回调onCancel(callback) {this.onCancel = callback;return this;}// 代理 Promise 方法then(...args) {this.promise.then(...args);return this;}catch(...args) {this.promise.catch(...args);return this;}}// 示例：取消异步请求const abortController = new AbortController();const cancelablePromise = new CancelablePromise((resolve, reject) => {fetch('https://api.example.com/data', {signal: abortController.signal}).then(res => res.json()).then(resolve).catch(reject);}).onCancel(() => {\n    abortController.abort(); // 中止 fetch 请求console.log('请求已取消');}).then(data => console.log('请求成功', data)).catch(err => console.log('请求失败', err.message));// 3秒后取消setTimeout(() => {\n  cancelablePromise.cancel('用户主动取消');}, 3000);\n```";export{e as default};
